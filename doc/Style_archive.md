Навигация: [Главная страница](Main_Page.md)/[Система
ejudge](Система_ejudge.md)/[Использование](Использование.md)/[Виды
задач](Виды_задач.md)/[Задача на написание
тестов](Задача:tests.md)/[Программа
style_archive](style_archive.md)

Программа style_archive предназначена для проверки правильности
[структуры архива с тестами](структура_архива_с_тестами.md),
сдаваемого в случае [задач на написание
тестов](Задача:tests.md). Программа входит в состав системы
ejudge. Параметры проверки архива могут задаваться в командной строке и
в переменных окружения. Параметры, заданные в командной строке,
переопределяют параметры, заданные в переменных окружения.

Программа в настоящее время поддерживает архивы, основанные на формате
TAR с последующим сжатием (.tar.gz, .tar.bz2), а также ZIP-архивы. Для
поддержки ZIP-архивов на сервере должна быть установлена программа 7z.

Все диагностические сообщения выводятся на стандартный поток ошибок. В
случае, если архив был отвергнут программой, диагностические сообщения
могут использоваться для обнаружения и устранения причины ошибки. Если
архив оказался корректным, то на стандартный поток вывода выводится
содержимое файла `README` и тестовых файлов.

В случае успешного завершения программа завершается с кодом 0. В случае
ошибки код завершения — 1.

При использовании программы в ejudge параметры настройки программы
следует передавать через переменные окружения, а не через командную
строку. Для этого можно использовать конфигурационную переменную
<tt>[style_checker_env](serve.cfg:problem:style_checker_env.md).

### Использование

Программа используется следующим образом.

`style_archive [OPTIONS...] ARCHIVE-NAME`

Здесь `ARCHIVE-NAME` — это путь к файлу проверяемого архива. Программа
поддерживает следующие опции командной строки.

<table border="1">
<tr>
<td width="10%">

`-z SZ`

</td>
<td>

Позволяет задать максимальный суммарный размер файлов после
разархивирования. Если суммарный размер файлов в архиве превосходит
указанную величину, архив отвергается. См. также переменную окружения
`EJ_MAX_ARCHIVE_SIZE`. Значение по умолчанию — 1 мегабайт.

</td>
</tr>
<tr>
<td width="10%">

`-f SZ`

</td>
<td>

Позволяет задать максимальный размер одного файла после
разархивирования. Если размер какого-либо файла в архиве превосходит
указанную величину, архив отвергается. См. также переменную окружения
`EJ_MAX_FILE_SIZE`. Значение по умолчанию — 1 мегабайт.

</td>
</tr>
<tr>
<td width="10%">

`-n NUM`

</td>
<td>

Позволяет задать максимальное число файлов в архиве. Если общее число
файлов в архиве превосходит указанную величину, архив отвергается. См.
также переменную окружения `EJ_MAX_FILE_COUNT`. Значение по умолчанию —
128.

</td>
</tr>
<tr>
<td width="10%">

`-t`

</td>
<td>

Включает режим проверки архива с тестами. В этом режиме контролируется
количество и правильное именование файлов с тестами.

</td>
</tr>
<tr>
<td width="10%">

`-c NUM`

</td>
<td>

Позволяет задать максимальное число тестов в архиве. Если общее число
тестов в архиве превосходит указанную величину, архив отвергается. См.
также переменную окружения `EJ_MAX_TEST_COUNT`. Значение по умолчанию —
99.

</td>
</tr>
<tr>
<td width="10%">

`-i PAT`

</td>
<td>

Позволяет задать шаблон для файлов с тестовыми данными. См. также
переменную окружения `EJ_INPUT_PATTERN`. Значение по умолчанию —
`%03d.dat`.

</td>
</tr>
<tr>
<td width="10%">

`-o PAT`

</td>
<td>

Позволяет задать шаблон для файлов с правильными ответами. См. также
переменную окружения `EJ_OUTPUT_PATTERN`. Значение по умолчанию —
`%03d.ans`.

</td>
</tr>
<tr>
<td width="10%">

`-r`

</td>
<td>

Позволяет игнорировать отсутствие в архиве файла README.

</td>
</tr>
<tr>
<td width="10%">

`-.`

</td>
<td>

Позволяет игнорировать файлы, имена которых начинаются с символа "точка"
(скрытые файлы).

</td>
</tr>
<tr>
<td width="10%">

`-m`

</td>
<td>

Включает режим проверки архива для сборки. По умолчанию включен режим
проверки архива тестов.

</td>
</tr>
<tr>
<td width="10%">

`-p DIR`

</td>
<td>

Имя каталога с файлами для сборки, который должен находится в архиве.
Значение по умолчанию - solution.

</td>
</tr>
<tr>
<td width="10%">

`-s FILE`

</td>
<td>

Название скрипта для сборки, который должен находиться в архиве.
Значение по умолчанию - Makefile.

</td>
</tr>
</table>

В параметрах, требующих размер (обозначается `SZ`), допускается
использование суффиксов `K`, `M` или `G`, обозначающих масштабные
множители для килобайта, мегабайта и гигабайта соответственно.

### Переменные окружения

Поддерживаются следующие переменные окружения.

<table border="1">
<tr>
<td width="15%">

`EJ_MAX_ARCHIVE_SIZE=SZ`

</td>
<td>

Позволяет задать максимальный суммарный размер файлов после
разархивирования. См. параметр командной строки `-z`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_MAX_FILE_SIZE=SZ`

</td>
<td>

Позволяет задать максимальный размер файла после разархивирования. См.
параметр командной строки `-f`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_MAX_FILE_COUNT=NUM`

</td>
<td>

Позволяет задать максимальное число файлов в архиве. См. параметр
командной строки `-n`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_TESTS_MODE=1`

</td>
<td>

Включает режим проверки архива с тестами. См. параметр командной строки
`-t`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_MAX_TEST_COUNT=NUM`

</td>
<td>

Позволяет задать максимальное число тестов в архиве. См. параметр
командной строки `-c`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_INPUT_PATTERN=PAT`

</td>
<td>

Позволяет задать шаблон для файлов с тестовыми данными. См. параметр
командной строки `-i`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_OUTPUT_PATTERN=PAT`

</td>
<td>

Позволяет задать шаблон для файлов с ответами к тестовым данным. См.
параметр командной строки `-o`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_NO_README=1`

</td>
<td>

Позволяет игнорировать отсутствие в архиве файла README. См. параметр
командной строки `-r`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_IGNORE_DOT_FILES=1`

</td>
<td>

Позволяет игнорировать отсутствие в архиве файлы, имена которых
начинаются с символа "точка" (скрытые файлы). См. параметр командной
строки `-.`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_MAKE_MODE=1`

</td>
<td>

Включает режим проверки архива для сборки. См. параметр командной строки
`-m`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_PROGRAM_DIR=DIR`

</td>
<td>

Имя каталога с файлами для сборки, который должен находится в архиве.
См. параметр командной строки `-p`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_SCRIPT_NAME=NAME`

</td>
<td>

Название скрипта для сборки, который должен находиться в архиве. См.
параметр командной строки `-s`.

</td>
</tr>
<tr>
<td width="15%">

`EJ_FORBIDDEN_NAMES=NAME-LIST`

</td>
<td>

Список имен файлов, которые не должны находиться в архиве. Имена в
списке разделяются запятой. Например, при приеме архива для последующей
компиляции с помощью make следуюет запретить нахождение в архиве
исполняемого файла-цели компиляции. (начиная с версии
[2.3.20](Изменения_в_версии_2.3.20.md))

</td>
</tr>
<tr>
<td width="15%">

`EJ_FORBIDDEN_SUFFIXES=SUFFIX-LIST`

</td>
<td>

Список суффиксов имен файлов, которые не должны находиться в архиве.
Суффиксы в списке разделяются запятой. Например, при приеме архива для
последующей компиляции с помощью make следуюет запретить нахождение в
архиве объектных файлов (суффикс .o). (начиная с версии
[2.3.20](Изменения_в_версии_2.3.20.md))

</td>
</tr>
</table>

В переменных окружения, требующих размер (обозначается `SZ`),
допускается использование суффиксов `K`, `M` или `G`, обозначающих
масштабные множители для килобайта, мегабайта и гигабайта
соответственно.

### Поддерживаемые форматы архивов

<table border="1">
<tr>
<th>

Формат

</th>
<th>

Описание

</th>
<th>

Команда создания

</th>
<th>

Команда разархивирования

</th>
</tr>
<tr>
<td>

tar

</td>
<td>

Несжатый архив

</td>
<td>

`tar cf file.tar tests`

</td>
<td>

`tar xf file.tar`

</td>
</tr>
<tr>
<td>

tgz

</td>
<td>

Архив tar, сжатый программой gzip

</td>
<td>

`tar cfz file.tgz tests`

</td>
<td>

`tar xf file.tgz`

</td>
</tr>
<tr>
<td>

tbz

</td>
<td>

Архив tar, сжатый программой bzip2

</td>
<td>

`tar cfj file.tgz tests`

</td>
<td>

`tar xf file.tgz`

</td>
</tr>
<tr>
<td>

zip

</td>
<td>

Архив zip

</td>
<td>

`zip -r file.zip tests`

</td>
<td>

`7z x file.zip`

</td>
</tr>
</table>
